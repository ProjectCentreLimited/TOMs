# -- Packaging --------------------------------------
[metadata]
description-file = README.md

# -- Code quality ------------------------------------

[flake8]
count = True
exclude =
    # No need to traverse our git directory
    .git,
    # There's no value in checking cache directories
    __pycache__,
    # The conf file is mostly autogenerated, ignore it
    docs/conf.py,
    # The old directory contains Flake8 2.0
    old,
    # This contains our built documentation
    build,
    # This contains builds of flake8 that we don't want to check
    dist,
    # This contains local virtual environments
    .venv*,
    # do not watch on tests
    tests,
    # do not consider external packages
    */external/*, ext_libs/*,
    # to launch the API, 2 variables must be declared in the imports
    TOMsPlugin.py
ignore = E121,E123,E126,E203,E226,E24,E704,QGS105,W503,W504
max-complexity = 15
max-doc-length = 130
max-line-length = 120
output-file = dev_flake8_report.txt
statistics = True
tee = True

[pylint]
disable = W0212,W0122
max-line-length = 120
ignore-paths = docs/conf.py

[isort]
ensure_newline_before_comments = True
force_grid_wrap = 2
include_trailing_comma = True
line_length = 100
multi_line_output = 3
profile = black
use_parentheses = True

# -- Tests ----------------------------------------------
[tool:pytest]
addopts =
    --cov-config=setup.cfg
    --cov=transapi
    --ignore=tests/_wip/
norecursedirs = .* build dev development dist docs CVS fixtures _darcs {arch} *.egg venv _wip
python_files = test_*.py
testpaths = tests

[coverage:run]
branch = True
omit =
    venv/*
    .venv/*
    *tests*

[coverage:report]
ignore_errors = True
show_missing = True
exclude_lines =
    if self.debug:
    pragma: no cover
    raise NotImplementedError
    if __name__ == .__main__.:


# -- SQL ----------------------------------------------
[sqlfluff]
#templater = jinja
dialect = postgres
sql_file_exts = .sql,.sql.j2,.dml,.ddl
exclude_rules = L046,L059,L003,L017

[sqlfluff:rules]
tab_space_size = 4
max_line_length = 120
indent_unit = space
comma_style = trailing
allow_scalar = True
single_table_references = consistent
unquoted_identifiers_policy = all

[sqlfluff:indentation]
indented_joins = false
indented_using_on = true
template_blocks_indent = false

[sqlfluff:templater]
unwrap_wrapped_queries = true

# [sqlfluff:templater:jinja]
# apply_dbt_builtins = true

[sqlfluff:rules:L010]
# Keywords
capitalisation_policy = upper
